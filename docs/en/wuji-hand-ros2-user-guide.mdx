---
title: ROS2 Driver User Guide
---

## 1. Overview

The Wuji Hand ROS2 driver provides complete support for the dexterous hand within the ROS2 ecosystem. Key features include:

- **1000Hz Joint State Publishing**: High-frequency real-time feedback for joint positions and effort
- **Real-time Control Interface**: Control the dexterous hand via ROS2 Topics and Services
- **Multi-hand Support**: Support for running multiple hands simultaneously using namespaces
- **RViz Visualization**: Built-in URDF model for real-time visualization

## 2. System Requirements

### 2.1 Software Versions

| Software | Minimum Version |
|:---------|:----------------|
| Wuji Hand SDK | 1.5.0 |
| Firmware | 1.2.0 |

### 2.2 Supported Platforms

| ROS2 Version | Ubuntu Version |
|:-------------|:---------------|
| Humble | 22.04 LTS |
| Kilted | 24.04 LTS |

## 3. Installation Guide

<Callout type="info">
Please ensure you have completed the configuration according to [System Requirements](#2-system-requirements) before proceeding.
</Callout>

### 3.1 Install Wuji Hand SDK

Before installing the ROS2 driver, you need to install the Wuji Hand SDK:

```bash
# Replace ${SDK_VERSION} with the actual version number, e.g., 1.5.0
wget https://github.com/wuji-technology/wujihandpy/releases/download/v${SDK_VERSION}/wujihandcpp-${SDK_VERSION}-amd64.deb
sudo apt install ./wujihandcpp-${SDK_VERSION}-amd64.deb
```

### 3.2 Install ROS2 Driver

The ROS2 driver offers two installation methods. Choose based on your use case:

#### Option 1: Build from Source (Recommended)

**Install Dependencies**

Choose the command based on your Ubuntu version:

**Ubuntu 22.04 (ROS2 Humble)**

```bash
# Install ROS2 Humble and dependencies
sudo apt update
sudo apt install -y ros-humble-ros-base ros-humble-robot-state-publisher \
    ros-humble-rviz2 ros-humble-sensor-msgs ros-humble-std-msgs \
    python3-colcon-common-extensions python3-rosdep
```

**Ubuntu 24.04 (ROS2 Kilted)**

```bash
# Install ROS2 Kilted and dependencies
sudo apt update
sudo apt install -y ros-kilted-ros-base ros-kilted-robot-state-publisher \
    ros-kilted-rviz2 ros-kilted-sensor-msgs ros-kilted-std-msgs \
    python3-colcon-common-extensions python3-rosdep
```

**Build**

```bash
# Clone the repository
git clone https://github.com/wuji-technology/wujihandros2.git
cd wujihandros2

# Fetch URDF model submodule (required)
git submodule update --init --recursive

# Source ROS2 environment, replace ${distro} with your installed ROS2 distribution
source /opt/ros/${distro}/setup.bash

# Build
colcon build

# Source workspace
source install/setup.bash
```

<Callout type="warning">
You must run `git submodule update --init --recursive` before building. The `external/wuji-hand-description/` directory contains the URDF models required for compilation.
</Callout>

#### Option 2: Deb Package Installation

**Ubuntu 22.04 (ROS2 Humble)**

```bash
# Install dependencies
sudo apt update
sudo apt install -y ros-humble-ros-base ros-humble-robot-state-publisher \
    ros-humble-sensor-msgs ros-humble-std-msgs

# Download and install from GitHub Releases (replace ${VERSION} with actual version)
wget https://github.com/wuji-technology/wujihandros2/releases/download/v${VERSION}/ros-humble-wujihand_${VERSION}_amd64.deb
sudo apt install ./ros-humble-wujihand_${VERSION}_amd64.deb
```

**Ubuntu 24.04 (ROS2 Kilted)**

```bash
# Install dependencies
sudo apt update
sudo apt install -y ros-kilted-ros-base ros-kilted-robot-state-publisher \
    ros-kilted-sensor-msgs ros-kilted-std-msgs

# Download and install from GitHub Releases
wget https://github.com/wuji-technology/wujihandros2/releases/download/v${VERSION}/ros-kilted-wujihand_${VERSION}_amd64.deb
sudo apt install ./ros-kilted-wujihand_${VERSION}_amd64.deb
```

## 4. Quick Start

### 4.1 Launch the Driver

```bash
# (If built from source) Source ROS2 environment, replace ${distro} with your ROS2 distribution
source /opt/ros/${distro}/setup.bash
source install/setup.bash

# Launch the driver
ros2 launch wujihand_bringup wujihand.launch.py
```

On successful launch, you will see the following output:

```text
[wujihand_driver]: Connected to WujiHand (right)
[wujihand_driver]: WujiHand driver started (state: 1000.0 Hz, diagnostics: 10.0 Hz)
```

### 4.2 Verify Operation

Open a new terminal and check the joint states:

```bash
# Source ROS2 environment, replace ${distro} with your ROS2 distribution
source /opt/ros/${distro}/setup.bash
source install/setup.bash

ros2 topic echo /hand_0/joint_states --once
```

### 4.3 Run Demo

```bash
# Wave demo: fingers curl and extend in sequence
ros2 run wujihand_bringup wave_demo.py
```

### 4.4 Launch RViz Visualization

```bash
ros2 launch wujihand_bringup wujihand.launch.py rviz:=true
```

**Result**

![RViz Visualization](images/rviz-visualization.png)

## 5. Launch and Configuration

### 5.1 Launch Commands

| Command | Description |
|:--------|:------------|
| `ros2 launch wujihand_bringup wujihand.launch.py` | Launch driver only |
| `ros2 launch wujihand_bringup wujihand.launch.py rviz:=true` | Launch driver with RViz visualization |

### 5.2 Configurable Parameters

| Parameter | Default | Description |
|:----------|:--------|:------------|
| `hand_name` | `hand_0` | Namespace for distinguishing multiple hands. Example: `ros2 launch wujihand_bringup wujihand.launch.py hand_name:=my_hand` |
| `serial_number` | `""` | Device serial number (auto-detect if empty) |
| `publish_rate` | `1000.0` | Joint state publishing rate (Hz) |
| `filter_cutoff_freq` | `10.0` | Low-pass filter cutoff frequency (Hz) |
| `diagnostics_rate` | `10.0` | Diagnostics publishing rate (Hz) |
| `rviz` | `false` | Whether to launch RViz visualization |

<Callout type="info">
Handedness (left/right) is automatically detected from hardware. No manual specification required.
</Callout>

### 5.3 Multi-hand Configuration

When controlling multiple dexterous hands simultaneously, use serial numbers and namespaces to distinguish them.

If opening a new terminal, you need to source the ROS2 environment again:
```bash
# (If built from source) Source ROS2 environment, replace ${distro} with your ROS2 distribution
source /opt/ros/${distro}/setup.bash
source install/setup.bash
```

```bash
# Terminal 1: Launch left hand
ros2 launch wujihand_bringup wujihand.launch.py \
    hand_name:=left_hand serial_number:=ABC123

# Terminal 2: Launch right hand
ros2 launch wujihand_bringup wujihand.launch.py \
    hand_name:=right_hand serial_number:=DEF456
```

After launch, each hand has its own topic namespace:

```text
# Left hand topics
/left_hand/joint_states
/left_hand/joint_commands
/left_hand/hand_diagnostics
/left_hand/robot_description
/left_hand/tf
/left_hand/tf_static

# Right hand topics
/right_hand/joint_states
/right_hand/joint_commands
/right_hand/hand_diagnostics
/right_hand/robot_description
/right_hand/tf
/right_hand/tf_static
```

### 5.4 Joint Identification

The dexterous hand has 20 joints (5 fingers × 4 joints per finger).

#### Finger and Joint IDs

[Service Calls](#62-service-calls) use `finger_id` and `joint_id`:

| Parameter | Values and Meanings |
|:----------|:--------------------|
| `finger_id` | <ul><li>0: Thumb</li><li>1: Index</li><li>2: Middle</li><li>3: Ring</li><li>4: Pinky</li><li>255: All fingers</li></ul> |
| `joint_id` | <ul><li>0-3: Individual joints (0 → 3: proximal → distal)</li><li>255: All joints</li></ul> |

#### Joint Name Format

[Topic Control](#63-topic-control) uses full joint names: `{hand_name}/finger{1-5}_joint{1-4}`

| Index | Joint Name (hand_name=hand_0) | Finger |
|:------|:------------------------------|:-------|
| 0-3 | hand_0/finger1_joint1~4 | Thumb |
| 4-7 | hand_0/finger2_joint1~4 | Index |
| 8-11 | hand_0/finger3_joint1~4 | Middle |
| 12-15 | hand_0/finger4_joint1~4 | Ring |
| 16-19 | hand_0/finger5_joint1~4 | Pinky |

#### Index Calculation

```text
index = finger_id * 4 + joint_id
```

For example: The index finger (finger_id=1) third joint (joint_id=2) has index `1 * 4 + 2 = 6`.

## 6. ROS2 Interface

### 6.1 Interface Reference

#### HandDiagnostics Message

`wujihand_msgs/msg/HandDiagnostics`: Hardware diagnostics, published at 10Hz.

```text
std_msgs/Header header
string handedness               # "left" or "right"
float32 system_temperature      # System temperature (°C)
float32 input_voltage           # Input voltage (V)
float32[20] joint_temperatures  # Joint temperatures (°C)
uint32[20] error_codes          # Error codes (0=normal)
bool[20] enabled                # Joint enabled status
float32[20] effort_limits       # Effort limit settings (A)
```

#### JointState Message

`sensor_msgs/msg/JointState`: Joint states, published at 1000Hz.

| Field | Type | Description |
|:------|:-----|:------------|
| `position` | `float64[20]` | Joint positions (radians) |
| `velocity` | `float64[20]` | Not used |
| `effort` | `float64[20]` | Joint effort (amperes) |

<Callout type="info">
**About the Effort Field**

Effort represents the actuator output in current space, filtered before output. It is not the actual measured current value; consider it as relative drive intensity.

Typical use cases:
- **Collision detection**: A sudden increase in effort indicates joint obstruction
- **Load monitoring**: Calculate current output percentage via `effort / effort_limit`

Default effort_limit is 1.5A, maximum 3.5A.
</Callout>

#### SetEnabled Service

`wujihand_msgs/srv/SetEnabled`: Enable or disable joints.

```text
# Request
uint8 finger_id   # 0-4 or 255 (all fingers)
uint8 joint_id    # 0-3 or 255 (all joints)
bool enabled      # true=enable, false=disable
---
# Response
bool success
string message
```

#### ResetError Service

`wujihand_msgs/srv/ResetError`: Reset joint error states.

```text
# Request
uint8 finger_id   # 0-4 or 255 (all fingers)
uint8 joint_id    # 0-3 or 255 (all joints)
---
# Response
bool success
string message
```

### 6.2 Service Calls

#### Enable/Disable Joints

```bash
# Disable all joints
ros2 service call /hand_0/set_enabled wujihand_msgs/srv/SetEnabled \
  "{finger_id: 255, joint_id: 255, enabled: false}"

# Enable all joints
ros2 service call /hand_0/set_enabled wujihand_msgs/srv/SetEnabled \
  "{finger_id: 255, joint_id: 255, enabled: true}"

# Enable only the index finger (finger_id=1)
ros2 service call /hand_0/set_enabled wujihand_msgs/srv/SetEnabled \
  "{finger_id: 1, joint_id: 255, enabled: true}"

# Enable only the first joint of thumb
ros2 service call /hand_0/set_enabled wujihand_msgs/srv/SetEnabled \
  "{finger_id: 0, joint_id: 0, enabled: true}"
```

#### Reset Errors

```bash
# Reset all joint errors
ros2 service call /hand_0/reset_error wujihand_msgs/srv/ResetError \
  "{finger_id: 255, joint_id: 255}"
```

### 6.3 Topic Control

#### Send Joint Position Commands

Joint positions are sent via the `/{hand_name}/joint_commands` topic using the `sensor_msgs/msg/JointState` message type.

**Method 1: Position Array (20 joints)**

```bash
# Zero all joints
ros2 topic pub /hand_0/joint_commands sensor_msgs/msg/JointState \
  "{position: [0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,0]}" --once
```

**Method 2: Specify Joint Names**

```bash
# Control only two joints of the index finger
ros2 topic pub /hand_0/joint_commands sensor_msgs/msg/JointState \
  "{name: ['hand_0/finger2_joint2', 'hand_0/finger2_joint3'], position: [1.0, 1.0]}" --once
```

#### Read Joint States

```bash
# Read joint states once (published at 1000Hz)
ros2 topic echo /hand_0/joint_states --once

# Read diagnostics (published at 10Hz)
ros2 topic echo /hand_0/hand_diagnostics --once
```

### 6.4 Code Examples

The following examples demonstrate how to create a ROS2 node to control the dexterous hand:
- Subscribe to joint state topics for real-time position feedback
- Publish joint position commands to control hand movement

#### Python

```python
import rclpy
from rclpy.node import Node
from sensor_msgs.msg import JointState

class WujiHandController(Node):
    """Dexterous hand control node for subscribing to states and publishing commands"""

    def __init__(self, hand_name='hand_0'):
        super().__init__('wujihand_controller')
        self.hand_name = hand_name

        # Create publisher: send joint position commands to joint_commands topic
        self.cmd_pub = self.create_publisher(
            JointState,
            f'/{hand_name}/joint_commands',
            10  # Queue depth
        )

        # Create subscriber: receive joint states from joint_states topic (1000Hz)
        self.state_sub = self.create_subscription(
            JointState,
            f'/{hand_name}/joint_states',
            self.state_callback,
            10  # Queue depth
        )

    def state_callback(self, msg):
        """
        Joint state callback
        msg.position: Current positions of 20 joints (radians)
        msg.effort: Current effort of 20 joints (amperes)
        """
        # Print the 4 joint positions of the thumb (indices 0-3)
        self.get_logger().info(f'Position: {msg.position[:4]}')

    def send_positions(self, positions):
        """
        Send joint position command
        positions: Array of 20 target positions for joints (radians)
        """
        msg = JointState()
        msg.position = list(positions)
        self.cmd_pub.publish(msg)

def main():
    # Initialize ROS2
    rclpy.init()

    # Create control node
    node = WujiHandController(hand_name='hand_0')

    # Send zero command to all joints (set all 20 joints to 0 radians)
    node.send_positions([0.0] * 20)

    # Enter event loop, continuously receive joint states
    rclpy.spin(node)

    # Cleanup
    rclpy.shutdown()

if __name__ == '__main__':
    main()
```

#### C++

```cpp
#include <rclcpp/rclcpp.hpp>
#include <sensor_msgs/msg/joint_state.hpp>

/**
 * Dexterous hand control node
 * Functions: subscribe to joint states, publish position commands
 */
class WujiHandController : public rclcpp::Node {
public:
    WujiHandController(const std::string& hand_name = "hand_0")
        : Node("wujihand_controller"), hand_name_(hand_name)
    {
        // Create publisher: send joint position commands to joint_commands topic
        cmd_pub_ = this->create_publisher<sensor_msgs::msg::JointState>(
            "/" + hand_name_ + "/joint_commands", 10);

        // Create subscriber: receive joint states from joint_states topic (1000Hz)
        state_sub_ = this->create_subscription<sensor_msgs::msg::JointState>(
            "/" + hand_name_ + "/joint_states", 10,
            std::bind(&WujiHandController::state_callback, this, std::placeholders::_1));
    }

    /**
     * Send joint position command
     * @param positions Array of 20 target positions for joints (radians)
     */
    void send_positions(const std::vector<double>& positions) {
        auto msg = sensor_msgs::msg::JointState();
        msg.position = positions;
        cmd_pub_->publish(msg);
    }

private:
    /**
     * Joint state callback
     * msg->position: Current positions of 20 joints (radians)
     * msg->effort: Current effort of 20 joints (amperes)
     */
    void state_callback(const sensor_msgs::msg::JointState::SharedPtr msg) {
        RCLCPP_INFO(this->get_logger(), "Received joint states");
    }

    std::string hand_name_;
    rclcpp::Publisher<sensor_msgs::msg::JointState>::SharedPtr cmd_pub_;
    rclcpp::Subscription<sensor_msgs::msg::JointState>::SharedPtr state_sub_;
};

int main(int argc, char** argv) {
    // Initialize ROS2
    rclcpp::init(argc, argv);

    // Create control node
    auto node = std::make_shared<WujiHandController>("hand_0");

    // Send zero command to all joints (set all 20 joints to 0 radians)
    node->send_positions(std::vector<double>(20, 0.0));

    // Enter event loop, continuously receive joint states
    rclcpp::spin(node);

    // Cleanup
    rclcpp::shutdown();
    return 0;
}
```

## 7. Appendix

### 7.1 Troubleshooting

#### Device Busy (ERROR_BUSY)

When encountering a device busy error, terminate the existing driver process first:

```bash
pkill -f wujihand_driver_node
pkill -f robot_state_publisher
ros2 launch wujihand_bringup wujihand.launch.py
```

#### Incomplete Topic or Service List

The ROS2 daemon may have cached old node information:

```bash
# Restart daemon
ros2 daemon stop
ros2 daemon start
sleep 2

# Check again
ros2 topic list
ros2 service list
```

Or use the `--no-daemon` option for direct query:

```bash
ros2 service list --no-daemon | grep -E "set_enabled|reset_error"
```

#### RViz Model Not Displaying

1. Confirm **Fixed Frame** is set to `{hand_name}/palm_link` (e.g., `hand_0/palm_link`)
2. Confirm **RobotModel**'s **Description Topic** is set to `/{hand_name}/robot_description`
3. Check if joint states are normal:

```bash
ros2 topic echo /hand_0/joint_states --once
```

### 7.2 Error Code Reference

| Error Code | Meaning | Solution |
|:-----------|:--------|:---------|
| 0 | Normal | - |
| 1 | Over-temperature protection | Wait for cooling and retry |
| 2 | Over-current protection | Check load, call reset_error service |
| 3 | Communication timeout | Check USB connection, restart driver |

### 7.3 Related Resources

- **GitHub Repository**: [wuji-technology/wujihandros2](https://github.com/wuji-technology/wujihandros2)
- **Deb Package Downloads**: [GitHub Releases](https://github.com/wuji-technology/wujihandros2/releases)
- **Wuji Hand SDK**: [GitHub Releases](https://github.com/wuji-technology/wujihandpy/releases)
- **Technical Support**: [support@wuji.tech](mailto:support@wuji.tech)
